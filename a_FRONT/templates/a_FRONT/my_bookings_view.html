{% extends 'layouts/front.html' %}    

{% block content %}

    <div class="container mx-auto px-4 py-8" x-data="myBookings()">
        <!-- Page Header -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">My Bookings</h2>
            <p class="text-gray-600">Manage your swimming lessons and track your progress</p>
        </div>

        <!-- Quick Stats -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-calendar-check text-2xl text-blue-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800" x-text="stats.upcoming"></h3>
                <p class="text-gray-600">Upcoming Lessons</p>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-check-circle text-2xl text-green-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800" x-text="stats.completed"></h3>
                <p class="text-gray-600">Completed Lessons</p>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="bg-yellow-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-clock text-2xl text-yellow-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800" x-text="stats.totalHours"></h3>
                <p class="text-gray-600">Total Hours</p>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-medal text-2xl text-purple-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800" x-text="stats.currentLevel"></h3>
                <p class="text-gray-600">Current Level</p>
            </div>
        </div>

        <!-- Filter and Search -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex flex-wrap gap-4 items-center">
                <div class="flex items-center space-x-2">
                    <label class="text-gray-700 font-medium">Filter by:</label>
                    <select x-model="selectedFilter" @change="filterBookings()" 
                            class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All Bookings</option>
                        <option value="upcoming">Upcoming</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                
                <div class="flex items-center space-x-2">
                    <label class="text-gray-700 font-medium">Date Range:</label>
                    <select x-model="selectedDateRange" @change="filterBookings()"
                            class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All Time</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth">This Month</option>
                        <option value="lastMonth">Last Month</option>
                    </select>
                </div>
                
                <div class="flex-1 max-w-md">
                    <div class="relative">
                        <input type="text" x-model="searchQuery" @input="filterBookings()" 
                               placeholder="Search by class name or instructor..."
                               class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bookings List -->
        <div class="space-y-6">
            <!-- Upcoming Lessons Section -->
            <div x-show="filteredBookings.some(b => b.status === 'upcoming')" class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-blue-600 text-white px-6 py-4">
                    <h3 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        Upcoming Lessons
                    </h3>
                </div>
                
                <div class="divide-y divide-gray-200">
                    <template x-for="booking in filteredBookings.filter(b => b.status === 'upcoming')" :key="booking.id">
                        <div class="p-6 hover:bg-gray-50 transition-colors">
                            <div class="md:flex md:items-center md:justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div 
                                            :class="booking.classColor"
                                            class="w-12 h-12 rounded-full flex items-center justify-center text-white"
                                        >
                                            <i :class="booking.classIcon"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-semibold text-gray-800" x-text="booking.className"></h4>
                                            <p class="text-gray-600" x-text="booking.instructor"></p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid md:grid-cols-3 gap-4 text-sm text-gray-600 mb-3">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-calendar text-blue-500"></i>
                                            <span x-text="formatDate(booking.date)"></span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-clock text-blue-500"></i>
                                            <span x-text="booking.time"></span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-map-marker-alt text-blue-500"></i>
                                            <span x-text="booking.location"></span>
                                        </div>
                                    </div>
                                    
                                    <div x-show="booking.notes" class="text-sm text-gray-600 bg-gray-50 p-2 rounded">
                                        <strong>Notes:</strong> <span x-text="booking.notes"></span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 md:mt-0 md:ml-6 flex flex-col space-y-2">
                                    <button @click="rescheduleBooking(booking)" 
                                            class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors text-sm">
                                        <i class="fas fa-calendar-times mr-1"></i>Reschedule
                                    </button>
                                    <button @click="cancelBooking(booking)" 
                                            class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm">
                                        <i class="fas fa-times mr-1"></i>Cancel
                                    </button>
                                    <button @click="viewDetails(booking)" 
                                            class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm">
                                        <i class="fas fa-eye mr-1"></i>Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Completed Lessons Section -->
            <div x-show="filteredBookings.some(b => b.status === 'completed')" class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-green-600 text-white px-6 py-4">
                    <h3 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-check-circle mr-2"></i>
                        Completed Lessons
                    </h3>
                </div>
                
                <div class="divide-y divide-gray-200">
                    <template x-for="booking in filteredBookings.filter(b => b.status === 'completed')" :key="booking.id">
                        <div class="p-6 hover:bg-gray-50 transition-colors">
                            <div class="md:flex md:items-center md:justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div 
                                            :class="booking.classColor"
                                            class="w-12 h-12 rounded-full flex items-center justify-center text-white"
                                        >
                                            <i :class="booking.classIcon"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-semibold text-gray-800" x-text="booking.className"></h4>
                                            <p class="text-gray-600" x-text="booking.instructor"></p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid md:grid-cols-3 gap-4 text-sm text-gray-600 mb-3">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-calendar text-green-500"></i>
                                            <span x-text="formatDate(booking.date)"></span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-clock text-green-500"></i>
                                            <span x-text="booking.time"></span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-star text-yellow-500"></i>
                                            <span x-text="booking.rating ? booking.rating + '/5 stars' : 'Not rated'"></span>
                                        </div>
                                    </div>
                                    
                                    <div x-show="booking.instructorFeedback" class="text-sm text-gray-600 bg-green-50 p-3 rounded">
                                        <strong>Instructor Feedback:</strong> <span x-text="booking.instructorFeedback"></span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 md:mt-0 md:ml-6 flex flex-col space-y-2">
                                    <button @click="rateLesson(booking)" 
                                            :class="booking.rating ? 'bg-gray-400' : 'bg-yellow-500 hover:bg-yellow-600'"
                                            class="px-4 py-2 text-white rounded-lg transition-colors text-sm">
                                        <i class="fas fa-star mr-1"></i>
                                        <span x-text="booking.rating ? 'Rated' : 'Rate Lesson'"></span>
                                    </button>
                                    <button @click="bookAgain(booking)" 
                                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm">
                                        <i class="fas fa-redo mr-1"></i>Book Again
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Cancelled Lessons Section -->
            <div x-show="filteredBookings.some(b => b.status === 'cancelled')" class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-red-600 text-white px-6 py-4">
                    <h3 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-times-circle mr-2"></i>
                        Cancelled Lessons
                    </h3>
                </div>
                
                <div class="divide-y divide-gray-200">
                    <template x-for="booking in filteredBookings.filter(b => b.status === 'cancelled')" :key="booking.id">
                        <div class="p-6 hover:bg-gray-50 transition-colors opacity-75">
                            <div class="md:flex md:items-center md:justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div 
                                            class="w-12 h-12 rounded-full flex items-center justify-center text-white bg-gray-400"
                                        >
                                            <i :class="booking.classIcon"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-semibold text-gray-800" x-text="booking.className"></h4>
                                            <p class="text-gray-600" x-text="booking.instructor"></p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid md:grid-cols-3 gap-4 text-sm text-gray-600 mb-3">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-calendar text-red-500"></i>
                                            <span x-text="formatDate(booking.date)"></span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-clock text-red-500"></i>
                                            <span x-text="booking.time"></span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-info-circle text-red-500"></i>
                                            <span x-text="'Cancelled on ' + formatDate(booking.cancelledDate)"></span>
                                        </div>
                                    </div>
                                    
                                    <div x-show="booking.cancellationReason" class="text-sm text-gray-600 bg-red-50 p-3 rounded">
                                        <strong>Cancellation Reason:</strong> <span x-text="booking.cancellationReason"></span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 md:mt-0 md:ml-6 flex flex-col space-y-2">
                                    <button @click="bookAgain(booking)" 
                                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm">
                                        <i class="fas fa-redo mr-1"></i>Book Again
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Empty State -->
            <div x-show="filteredBookings.length === 0" class="bg-white rounded-xl shadow-lg p-12 text-center">
                <div class="bg-gray-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-calendar-times text-4xl text-gray-400"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">No bookings found</h3>
                <p class="text-gray-600 mb-6">You don't have any bookings matching your current filter criteria.</p>
                <a href="classes.html" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors inline-flex items-center space-x-2">
                    <i class="fas fa-plus"></i>
                    <span>Book Your First Lesson</span>
                </a>
            </div>
        </div>

        <!-- Modals -->
        <!-- Rating Modal -->
        <div x-show="showRatingModal" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
             @click.self="showRatingModal = false">
            
            <div class="bg-white rounded-xl p-6 m-4 max-w-md w-full">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">Rate Your Lesson</h3>
                    <button @click="showRatingModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div x-show="selectedBookingForRating" class="space-y-4">
                    <div class="text-center">
                        <h4 class="font-semibold" x-text="selectedBookingForRating?.className"></h4>
                        <p class="text-gray-600" x-text="selectedBookingForRating?.instructor"></p>
                    </div>

                    <div class="text-center">
                        <p class="text-gray-700 mb-3">How was your lesson?</p>
                        <div class="flex justify-center space-x-2">
                            <template x-for="star in 5" :key="star">
                                <button @click="rating = star" 
                                        :class="rating >= star ? 'text-yellow-400' : 'text-gray-300'"
                                        class="text-3xl hover:text-yellow-400 transition-colors">
                                    <i class="fas fa-star"></i>
                                </button>
                            </template>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Comments (optional)</label>
                        <textarea x-model="ratingComment" rows="3" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  placeholder="Share your feedback about the lesson..."></textarea>
                    </div>

                    <div class="flex space-x-3 pt-4">
                        <button @click="showRatingModal = false"
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button @click="submitRating()"
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Submit Rating
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script>
        function myBookings() {
            return {
                selectedFilter: 'all',
                selectedDateRange: 'all',
                searchQuery: '',
                showRatingModal: false,
                selectedBookingForRating: null,
                rating: 0,
                ratingComment: '',

                stats: {
                    upcoming: 3,
                    completed: 12,
                    totalHours: 18,
                    currentLevel: 'Intermediate'
                },

                allBookings: [
                    {
                        id: 1,
                        className: 'Adult Beginner Swimming',
                        instructor: 'Sarah Johnson',
                        date: '2025-10-10',
                        time: '9:00 AM - 10:00 AM',
                        location: 'Pool A',
                        status: 'upcoming',
                        classIcon: 'fas fa-swimming-pool',
                        classColor: 'bg-green-500',
                        notes: 'Focus on breathing techniques',
                        price: 45
                    },
                    {
                        id: 2,
                        className: 'Intermediate Stroke Technique',
                        instructor: 'Mike Chen',
                        date: '2025-10-12',
                        time: '2:00 PM - 3:15 PM',
                        location: 'Pool B',
                        status: 'upcoming',
                        classIcon: 'fas fa-swimmer',
                        classColor: 'bg-blue-500',
                        notes: 'Backstroke improvement session',
                        price: 55
                    },
                    {
                        id: 3,
                        className: 'Private Swimming Lesson',
                        instructor: 'Emma Rodriguez',
                        date: '2025-10-15',
                        time: '4:00 PM - 5:00 PM',
                        location: 'Pool C',
                        status: 'upcoming',
                        classIcon: 'fas fa-user-tie',
                        classColor: 'bg-gray-600',
                        notes: 'One-on-one technique refinement',
                        price: 95
                    },
                    {
                        id: 4,
                        className: 'Adult Beginner Swimming',
                        instructor: 'Sarah Johnson',
                        date: '2025-10-03',
                        time: '9:00 AM - 10:00 AM',
                        location: 'Pool A',
                        status: 'completed',
                        classIcon: 'fas fa-swimming-pool',
                        classColor: 'bg-green-500',
                        rating: 5,
                        instructorFeedback: 'Great progress on floating! Keep practicing the breathing exercises.',
                        price: 45
                    },
                    {
                        id: 5,
                        className: 'Intermediate Stroke Technique',
                        instructor: 'Mike Chen',
                        date: '2025-09-28',
                        time: '2:00 PM - 3:15 PM',
                        location: 'Pool B',
                        status: 'completed',
                        classIcon: 'fas fa-swimmer',
                        classColor: 'bg-blue-500',
                        rating: 4,
                        instructorFeedback: 'Excellent backstroke improvement. Ready to work on butterfly next.',
                        price: 55
                    },
                    {
                        id: 6,
                        className: 'Kids Swimming',
                        instructor: 'Emma Rodriguez',
                        date: '2025-09-15',
                        time: '10:30 AM - 11:15 AM',
                        location: 'Pool A',
                        status: 'cancelled',
                        classIcon: 'fas fa-child',
                        classColor: 'bg-yellow-500',
                        cancelledDate: '2025-09-14',
                        cancellationReason: 'Student illness',
                        price: 35
                    }
                ],

                get filteredBookings() {
                    let filtered = this.allBookings;

                    // Filter by status
                    if (this.selectedFilter !== 'all') {
                        filtered = filtered.filter(booking => booking.status === this.selectedFilter);
                    }

                    // Filter by search query
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(booking => 
                            booking.className.toLowerCase().includes(query) ||
                            booking.instructor.toLowerCase().includes(query)
                        );
                    }

                    // Filter by date range
                    if (this.selectedDateRange !== 'all') {
                        const now = new Date();
                        filtered = filtered.filter(booking => {
                            const bookingDate = new Date(booking.date);
                            switch (this.selectedDateRange) {
                                case 'thisWeek':
                                    const weekStart = new Date(now);
                                    weekStart.setDate(now.getDate() - now.getDay());
                                    const weekEnd = new Date(weekStart);
                                    weekEnd.setDate(weekStart.getDate() + 7);
                                    return bookingDate >= weekStart && bookingDate < weekEnd;
                                case 'thisMonth':
                                    return bookingDate.getMonth() === now.getMonth() && 
                                           bookingDate.getFullYear() === now.getFullYear();
                                case 'lastMonth':
                                    const lastMonth = new Date(now);
                                    lastMonth.setMonth(now.getMonth() - 1);
                                    return bookingDate.getMonth() === lastMonth.getMonth() && 
                                           bookingDate.getFullYear() === lastMonth.getFullYear();
                                default:
                                    return true;
                            }
                        });
                    }

                    return filtered;
                },

                filterBookings() {
                    // This method is called when filters change
                    // The computed property `filteredBookings` handles the actual filtering
                },

                formatDate(dateString) {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('en-US', {
                        weekday: 'short',
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                },

                rescheduleBooking(booking) {
                    // In real app, this would open a reschedule modal or redirect
                    alert(`Reschedule ${booking.className} with ${booking.instructor}`);
                },

                cancelBooking(booking) {
                    if (confirm(`Are you sure you want to cancel ${booking.className} on ${this.formatDate(booking.date)}?`)) {
                        // In real app, this would make an API call
                        booking.status = 'cancelled';
                        booking.cancelledDate = new Date().toISOString().split('T')[0];
                        booking.cancellationReason = 'Cancelled by student';
                        
                        // Update stats
                        this.stats.upcoming--;
                    }
                },

                viewDetails(booking) {
                    // In real app, this would show detailed booking information
                    alert(`Viewing details for ${booking.className}`);
                },

                rateLesson(booking) {
                    if (booking.rating) {
                        alert('You have already rated this lesson.');
                        return;
                    }
                    
                    this.selectedBookingForRating = booking;
                    this.rating = 0;
                    this.ratingComment = '';
                    this.showRatingModal = true;
                },

                submitRating() {
                    if (this.rating === 0) {
                        alert('Please select a rating.');
                        return;
                    }

                    this.selectedBookingForRating.rating = this.rating;
                    this.selectedBookingForRating.comment = this.ratingComment;
                    
                    this.showRatingModal = false;
                    alert('Thank you for your feedback!');
                },

                bookAgain(booking) {
                    // In real app, this would redirect to booking page with pre-filled class info
                    const classType = booking.className.toLowerCase().replace(/\s+/g, '-');
                    window.location.href = `weekly_schedule.html?class=${classType}`;
                }
            }
        }
    </script>

{% endblock %}